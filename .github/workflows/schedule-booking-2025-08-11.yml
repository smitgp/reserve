name: Schedule Booking for 2025-08-11

on:
  # Run on 2025-08-09 at 17:01 UTC (18:01 Netherlands time) 
  # This is when 2025-08-11 booking window opens
  schedule:
    - cron: '1 17 9 8 *'  # minute hour day month weekday
  
  # Manual trigger for testing
  workflow_dispatch:

jobs:
  reserve:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Create .env file
      env:
        EMAIL: ${{ secrets.EMAIL }}
        LOCATION: ${{ secrets.LOCATION }}
        TYPE: ${{ secrets.TYPE }}
        BASE_EMAIL: ${{ secrets.BASE_EMAIL }}
        ENGINE_BODY: ${{ secrets.ENGINE_BODY }}
      run: |
        cat > .env << EOF
        EMAIL=${{ secrets.EMAIL }}
        LOCATION=${{ secrets.LOCATION }}
        TYPE=${{ secrets.TYPE }}
        BASE_EMAIL=${{ secrets.BASE_EMAIL }}
        ENGINE_BODY=${{ secrets.ENGINE_BODY }}
        EOF
        
    - name: Book 2025-08-11 when window opens
      run: |
        echo "ðŸŽ¯ Scheduled booking: Running at optimal time to reserve 2025-08-11"
        echo "ðŸ“… Booking 2025-08-11 from 09:00 to 17:00 on Resource 565"
        echo "â° Perfect timing: Booking exactly when window opens!"
        node reserve.mjs --date "2025-08-11" --start "09:00" --end "17:00" --resource "565"
        
    - name: Upload logs (if any failures)
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: scheduled-booking-2025-08-11-logs
        path: |
          *.log
          debug_*.html
        retention-days: 7